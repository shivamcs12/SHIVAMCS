<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shivam Online Services | Secure Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
    /* ===== PREMIUM THEME CONFIG ===== */
    :root {
        --primary: #ff7b00; /* Neon Orange */
        --dark-bg: #0f172a;
        --card-bg: rgba(30, 41, 59, 0.7);
        --text-color: #ffffff;
        --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    }

    * { box-sizing: border-box; user-select: none; }

    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background-color: var(--dark-bg);
        background-image: 
            radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
            radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
            radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
        min-height: 100vh;
        color: var(--text-color);
        display: flex;
        justify-content: center;
        align-items: center;
        overflow-x: hidden;
    }

    /* ===== LOCK SCREEN (ATM STYLE) ===== */
    #lockScreen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(15px);
        z-index: 9999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    .pin-container {
        text-align: center;
        animation: fadeInDown 0.8s ease;
    }

    .pin-display {
        background: rgba(0,0,0,0.5);
        border: 2px solid var(--primary);
        width: 280px; height: 60px;
        margin-bottom: 20px;
        border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        font-size: 30px; letter-spacing: 10px; color: var(--primary);
        box-shadow: 0 0 15px rgba(255, 123, 0, 0.3);
    }

    .numpad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        width: 280px;
    }

    .num-btn {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        color: white;
        padding: 20px 0;
        font-size: 20px;
        border-radius: 50%;
        cursor: pointer;
        transition: 0.2s;
    }

    .num-btn:active { background: var(--primary); transform: scale(0.95); }
    .num-btn.clear { color: #ff4444; font-size: 16px; border-radius: 12px; }
    .num-btn.enter { background: var(--primary); color: white; font-size: 16px; border-radius: 12px; font-weight: bold; }

    /* ===== MAIN FORM (GLASSMORPHISM) ===== */
    .main-card {
        display: none; /* Hidden initially */
        background: var(--card-bg);
        backdrop-filter: blur(12px);
        border: var(--glass-border);
        box-shadow: var(--shadow);
        width: 95%; max-width: 900px;
        border-radius: 20px;
        padding: 30px;
        animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .header-area {
        text-align: center; border-bottom: 2px solid var(--primary); margin-bottom: 25px; padding-bottom: 15px;
    }
    
    .header-area h1 { margin: 0; font-size: 24px; text-transform: uppercase; letter-spacing: 1px; }
    .header-area p { margin: 5px 0 0; font-size: 12px; opacity: 0.7; }

    /* FORM GRID */
    .row { display: flex; gap: 20px; margin-bottom: 15px; }
    .col { flex: 1; }

    label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: #cbd5e1; }
    
    input, select {
        width: 100%; padding: 12px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid #475569;
        border-radius: 8px;
        color: white; font-size: 15px;
        transition: 0.3s;
    }
    
    input:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 10px rgba(255, 123, 0, 0.2); }

    /* BUTTONS */
    .btn-group { display: flex; gap: 15px; margin-top: 25px; }
    
    button.action-btn {
        flex: 1; padding: 15px; border: none; border-radius: 10px;
        font-weight: bold; font-size: 16px; cursor: pointer; color: white;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn-orange { background: linear-gradient(135deg, #ff7b00, #e65100); }
    .btn-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
    
    button.action-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

    /* TABLE */
    .table-container { margin-top: 30px; border-radius: 10px; overflow: hidden; border: 1px solid #334155; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; color: #cbd5e1; }
    th { background: rgba(255,255,255,0.1); padding: 12px; text-align: left; color: var(--primary); }
    td { padding: 10px 12px; border-bottom: 1px solid #334155; }
    tr:last-child td { border-bottom: none; }

    /* RECEIPT MODAL (PAPER STYLE) */
    #receiptView {
        display: none; position: fixed; inset: 0;
        background: #0f172a; z-index: 10000;
        overflow-y: auto; padding: 20px;
    }

    .paper-receipt {
        background: #fff; color: #000;
        width: 100%; max-width: 380px;
        margin: 20px auto;
        padding: 20px;
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
        position: relative;
    }
    
    /* Jagged Edge Effect */
    .paper-receipt::before {
        content: ""; position: absolute; top: -5px; left: 0; width: 100%; height: 10px;
        background: linear-gradient(135deg, #fff 5px, transparent 0) 0 5px, linear-gradient(-135deg, #fff 5px, transparent 0) 0 5px;
        background-size: 10px 10px; background-repeat: repeat-x;
    }

    .cut-line { border-top: 2px dashed #000; margin: 25px 0; position: relative; height: 10px; }
    .cut-line::after { content: "âœ‚"; position: absolute; top: -14px; right: 0; font-size: 18px; }

    /* ANIMATIONS */
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-50px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(100px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

    /* MOBILE ADJUSTMENTS */
    @media (max-width: 600px) {
        .row { flex-direction: column; gap: 10px; }
        .btn-group { flex-direction: column; }
        .main-card { padding: 20px; width: 100%; margin: 10px; }
    }

    @media print {
        #lockScreen, .main-card { display: none !important; }
        #receiptView { display: block !important; background: white; position: static; }
        .paper-receipt { box-shadow: none; margin: 0; max-width: 100%; }
        .no-print { display: none; }
    }
</style>
</head>
<body>

<div id="lockScreen">
    <div class="pin-container">
        <div style="margin-bottom: 20px;">
            <div style="font-size: 40px;">ðŸ”’</div>
            <h3 style="margin:5px 0; color:white;">SECURITY CHECK</h3>
        </div>

        <div class="pin-display" id="pinDisplay"></div>

        <div class="numpad">
            <div class="num-btn" onclick="addPin(1)">1</div>
            <div class="num-btn" onclick="addPin(2)">2</div>
            <div class="num-btn" onclick="addPin(3)">3</div>
            <div class="num-btn" onclick="addPin(4)">4</div>
            <div class="num-btn" onclick="addPin(5)">5</div>
            <div class="num-btn" onclick="addPin(6)">6</div>
            <div class="num-btn" onclick="addPin(7)">7</div>
            <div class="num-btn" onclick="addPin(8)">8</div>
            <div class="num-btn" onclick="addPin(9)">9</div>
            <div class="num-btn clear" onclick="clearPin()">CLR</div>
            <div class="num-btn" onclick="addPin(0)">0</div>
            <div class="num-btn enter" onclick="checkPin()">GO</div>
        </div>
        <p id="errorMsg" style="color:#ff4444; height: 20px; margin-top:10px;"></p>
    </div>
</div>

<div class="main-card" id="mainForm">
    <div class="header-area">
        <h1>Shivam Online Services</h1>
        <p>Vatica, Jaipur | +91 9664324706</p>
    </div>

    <div class="row">
        <div class="col">
            <label>Customer Name</label>
            <input type="text" id="custName" placeholder="Enter Name">
        </div>
        <div class="col">
            <label>Mobile Number</label>
            <input type="number" id="mobile" placeholder="Mobile No">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Service Type</label>
            <input type="text" id="service" placeholder="E.g. Pan Card, Aadhar">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Total Amount (â‚¹)</label>
            <input type="number" id="total" oninput="calcPending()">
        </div>
        <div class="col">
            <label>Paid Amount (â‚¹)</label>
            <input type="number" id="paid" oninput="calcPending()">
        </div>
        <div class="col">
            <label>Pending (â‚¹)</label>
            <input type="number" id="pending" readonly style="background:rgba(255,0,0,0.1); color: #ff7b00;">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Payment Mode</label>
            <select id="payMode">
                <option value="Cash">Cash</option>
                <option value="Online UPI">Online UPI</option>
                <option value="Card">Credit/Debit Card</option>
                <option value="Net Banking">Net Banking</option>
            </select>
        </div>
    </div>

    <div class="btn-group">
        <button class="action-btn btn-orange" id="saveBtn" onclick="generateReceipt()">Generat Receipt & Save</button>
        <button class="action-btn btn-blue" onclick="fetchRecords()">View Recent Records</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr><th>Date</th><th>Name</th><th>Service</th><th>Pending</th></tr>
            </thead>
            <tbody id="tableBody">
                <tr><td colspan="4" style="text-align:center;">No records loaded.</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="receiptView">
    <div class="paper-receipt">
        <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:10px;">
            <h2 style="margin:0; text-transform:uppercase;">Shivam Online Services</h2>
            <p style="margin:5px 0; font-size:12px;">Vatica, Jaipur | Mob: 9664324706</p>
        </div>

        <div style="font-size:13px; font-family: 'Courier New', monospace;">
            <p style="display:flex; justify-content:space-between;"><span>Receipt No:</span> <b id="rid1"></b></p>
            <p style="display:flex; justify-content:space-between;"><span>Date:</span> <span id="rdate1"></span></p>
            <hr style="border-top:1px dashed #ccc;">
            <p><b>Name:</b> <span id="rname1"></span></p>
            <p><b>Service:</b> <span id="rservice1"></span></p>
            <p><b>Mode:</b> <span id="rmode1"></span></p>
            <hr style="border-top:1px dashed #ccc;">
            <p style="display:flex; justify-content:space-between; font-size:16px;"><b>Total:</b> <b>â‚¹<span id="rtotal1"></span></b></p>
            <p style="display:flex; justify-content:space-between;"><span>Paid:</span> <span>â‚¹<span id="rpaid1"></span></span></p>
            <p style="display:flex; justify-content:space-between; color:red;"><span>Pending:</span> <b>â‚¹<span id="rpending1"></span></b></p>
        </div>

        <div style="margin-top:20px; font-size:11px; text-align:center;">
            * Fees once paid is non-refundable *<br>Thank you visit again
        </div>

        <div class="cut-line"></div>

        <div style="text-align:center; font-weight:bold; margin-bottom:10px;">OFFICE COPY</div>
        <div style="font-size:12px; font-family: 'Courier New', monospace;">
            <p>ID: <span id="rid2"></span> | Date: <span id="rdate2"></span></p>
            <p>Name: <span id="rname2"></span></p>
            <p>Svc: <span id="rservice2"></span></p>
            <p><b>Total: â‚¹<span id="rtotal2"></span> | Pending: â‚¹<span id="rpending2"></span></b></p>
        </div>

        <div class="no-print" style="margin-top:20px; display:flex; gap:10px;">
            <button onclick="window.print()" style="flex:1; padding:10px; background:#2563eb; color:white; border:none; border-radius:5px; cursor:pointer;">Print</button>
            <button onclick="location.reload()" style="flex:1; padding:10px; background:#f97316; color:white; border:none; border-radius:5px; cursor:pointer;">New</button>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzDmi56TXRo9EXZyDHC9ndKrussMvpBoYAbfz-rxBnCqvCk4Eiq5_LUGDlUp9fOoGDv/exec';
    const CORRECT_PIN = "38765700";
    
    // --- PIN LOGIC ---
    let currentPin = "";

    function addPin(num) {
        if(currentPin.length < 8) {
            currentPin += num;
            updateDisplay();
        }
    }

    function clearPin() {
        currentPin = "";
        updateDisplay();
        document.getElementById("errorMsg").innerText = "";
    }

    function updateDisplay() {
        // Show dots instead of numbers for privacy
        let dots = "";
        for(let i=0; i<currentPin.length; i++) dots += "â€¢";
        document.getElementById("pinDisplay").innerText = dots;
    }

    function checkPin() {
        if(currentPin === CORRECT_PIN) {
            document.getElementById("lockScreen").style.display = "none";
            document.getElementById("mainForm").style.display = "block";
        } else {
            const display = document.getElementById("pinDisplay");
            document.getElementById("errorMsg").innerText = "INCORRECT PIN";
            display.style.borderColor = "red";
            display.style.animation = "shake 0.3s";
            setTimeout(() => {
                display.style.animation = "";
                display.style.borderColor = "var(--primary)";
                clearPin();
            }, 500);
        }
    }

    // --- FORM LOGIC ---
    function calcPending() {
        let t = document.getElementById("total").value || 0;
        let p = document.getElementById("paid").value || 0;
        document.getElementById("pending").value = t - p;
    }

    function generateReceipt() {
        let name = document.getElementById("custName").value;
        if(!name) { alert("Enter Name!"); return; }

        let btn = document.getElementById("saveBtn");
        btn.innerHTML = "Saving..."; btn.disabled = true;

        let d = new Date();
        let data = {
            id: "TXN" + Math.floor(1000 + Math.random() * 9000),
            name: name,
            mobile: document.getElementById("mobile").value,
            service: document.getElementById("service").value,
            total: document.getElementById("total").value,
            paid: document.getElementById("paid").value,
            pending: document.getElementById("pending").value,
            mode: document.getElementById("payMode").value,
            date: d.toLocaleDateString('en-IN'),
            time: d.toLocaleTimeString('en-IN', {hour:'2-digit', minute:'2-digit'})
        };

        fillReceipt(data);

        fetch(SCRIPT_URL, {
            method: 'POST', body: JSON.stringify(data)
        }).then(() => {
            showReceiptView();
        }).catch(err => {
            alert("Network Error. Printing local receipt.");
            showReceiptView();
        });
    }

    function showReceiptView() {
        document.getElementById("mainForm").style.display = "none";
        document.getElementById("receiptView").style.display = "block";
    }

    function fillReceipt(d) {
        ['1','2'].forEach(id => {
            if(document.getElementById('rid'+id)) document.getElementById('rid'+id).innerText = d.id;
            if(document.getElementById('rdate'+id)) document.getElementById('rdate'+id).innerText = d.date;
            if(document.getElementById('rname'+id)) document.getElementById('rname'+id).innerText = d.name;
            if(document.getElementById('rservice'+id)) document.getElementById('rservice'+id).innerText = d.service;
            if(document.getElementById('rtotal'+id)) document.getElementById('rtotal'+id).innerText = d.total;
            if(document.getElementById('rpending'+id)) document.getElementById('rpending'+id).innerText = d.pending;
            if(document.getElementById('rmode'+id)) document.getElementById('rmode'+id).innerText = d.mode;
        });
        document.getElementById('rpaid1').innerText = d.paid;
    }

    function fetchRecords() {
        let tbody = document.getElementById("tableBody");
        tbody.innerHTML = "<tr><td colspan='4' style='text-align:center;'>Loading...</td></tr>";
        
        fetch(SCRIPT_URL)
        .then(r => r.json())
        .then(data => {
            let html = "";
            data.slice(-5).reverse().forEach(row => {
                html += `<tr>
                    <td>${row.date}</td>
                    <td>${row.name}</td>
                    <td>${row.service}</td>
                    <td style="color:${row.pending>0?'#ff4444':'#4ade80'}">â‚¹${row.pending}</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        });
    }
</script>
</body>
</html>
